# BDD-сценарии приёмки для Security NFR

Feature: Защита от повторного голосования
  Scenario: Пользователь не может проголосовать дважды за одну фичу
    Given пользователь с ID 1 существует
    And фича с ID 10 существует
    When пользователь 1 голосует за фичу 10
    And повторно отправляет тот же запрос
    Then возвращается ошибка с кодом "duplicate_vote" и статусом 409

Feature: Валидация входных данных
  Scenario: Некорректный user_id вызывает ошибку
    Given фича с ID 5 существует
    When отправляется POST /features/5/vote с user_id = "invalid"
    Then возвращается ошибка валидации со статусом 422

Feature: Защита от DoS на эндпоинте голосования
  Scenario: Превышение лимита запросов блокируется
    Given пользователь с ID 2 существует
    And фича с ID 20 существует
    When отправляется 6 запросов на /features/20/vote от user_id=2 за 60 сек
    Then 6-й запрос возвращает статус 429 (Too Many Requests)

Feature: Маскировка ошибок безопасности
  Scenario: Запрос несуществующей фичи не раскрывает структуру БД
    When отправляется GET /features/999999
    Then тело ответа содержит только {"error": {"code": "not_found", "message": "Feature not found"}}
    And не содержит stack trace или деталей ORM

Feature: Защита от SQL-инъекций (негативный сценарий)
  Scenario: Попытка SQL-инъекции через feature_id блокируется
    When отправляется GET /features/' OR '1'='1
    Then возвращается ошибка валидации (422), а не результат из БД
