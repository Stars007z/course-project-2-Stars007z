# Требования безопасности (Non-Functional Requirements)

| ID     | Название                          | Описание                                                                 | Метрика/Порог                                     | Проверка (чем/где)                                | Компонент | Приоритет |
|--------|-----------------------------------|--------------------------------------------------------------------------|---------------------------------------------------|---------------------------------------------------|-----------|-----------|
| NFR-01 | Защита от повторного голосования  | Один пользователь не может голосовать за одну фичу дважды                | 0% дублирующих голосов в логах/БД                 | e2e-тест + проверка в БД                          | vote      | High      |
| NFR-02 | Валидация входных данных          | Все входные данные (feature_id, user_id) строго типизированы и валидны   | 100% запросов с валидными типами (int ≥ 1)        | Pydantic-валидация + контракт-тесты               | api       | High      |
| NFR-03 | Маскировка ошибок безопасности    | Ошибки не раскрывают внутренние детали (PII, структуру БД и т.д.)        | Все ошибки соответствуют RFC7807, без stack trace | Лог-аудит + e2e-тесты                             | api       | Medium    |
| NFR-04 | Доступность API                   | Сервис должен быть доступен при умеренной нагрузке                        | SLA ≥ 99.5% на stage за 7 дней                    | Мониторинг (Prometheus/Grafana) + uptime-проверка | platform  | Medium    |
| NFR-05 | Защита от инъекций                | Запросы к БД защищены от SQL-инъекций                                    | 0 уязвимостей типа SQLi в SCA/ручном аудите       | SQLAlchemy ORM + SAST-сканирование                | db        | High      |
| NFR-06 | Уязвимости зависимостей           | Критические уязвимости в зависимостях устраняются в течение 7 дней        | Critical/High уязвимости ≤ 7 дней с момента обнаружения | CI (Trivy, Dependabot) + SBOM                  | build     | High      |
| NFR-07 | Логирование аномалий              | Подозрительные действия (например, flood голосований) логируются         | ≥1 алерт при >10 голосов/сек от одного user_id    | Логи + Loki/Grafana алерты                        | logging   | Medium    |
| NFR-08 | Защита от DoS на /vote            | Эндпоинт /vote защищён от перегрузки                                     | Макс. 5 запросов/мин на user_id (rate limit)      | Тест с locust + middleware проверка               | auth/rate | High      |
